<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Thumbnail details</title>
</head>

<body>
    <div class="container bg-primary bg-gradient">
        <h2 class="text-center py-2 mt-4 text-white">Upload Thumbnail</h2>
    </div>
    <div class="container d-flex justify-content-center">
        <form action="" method="post" class="w-50 p-3 shadow p-5 border border-dark" id="addform">
            {%csrf_token%} {{form.as_p}}
            <input class='addthumb' type="button" value="Add Thumbnail">
        </form>
    </div>
    <div class='d-flex justify-content-center mt-3'>
        <a href="{%url 'home' %}" class="col-sm-3 btn btn-dark btn-sm">
            <h2 class="text-center my-2 text-white">Rate Thumbnails</h2>
        </a>

    </div>
    <div class="container bg-danger bg-gradient">
        <h2 class="text-center py-2 mt-4 text-white">Thumbnail ratings</h2>
    </div>
    <div class="container shadow p-3 mb-5 bg-body rounded" id="imageAndRating">
        <ul>
            {%for tmb in tmbs%}
            <li class="row py-3">
                <div class="content col-sm 6">
                    <a href="{{tmb.url}}">
                        <img src="{{tmb.img_url}}" alt="" width="300" height="200" class="thumbimg">
                    </a>

                    <h4 style="display: inline;">
                        Thumbnail Rating: {{tmb.rating}}
                    </h4>
                </div>
            </li>
            {%endfor%}
        </ul>
    </div>


    <h3 class="text-center">Made with ❤️ by Aditya Yadav</h3>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <script>
        $('.addthumb').click(function() {
            let url = $('#urlid').val();
            let csr = $("input[name=csrfmiddlewaretoken]").val();
            let output = "<ul>";
            $.ajax({
                url: "{%url 'addthumb' %}",
                method: "POST",
                data: {
                    url: url,
                    csrfmiddlewaretoken: csr,
                },

                success: function(data) {
                    console.log(data);
                    x = data.thumbs;
                    for (let i = 0; i < x.length; i++) {
                        output += `<li class="row py-3">`
                        output += `<a href="${x[i].url}" class="col-sm-3">`
                        output += ` <img src="${x[i].img_url}" alt="" width="300" height="200" class="thumbimg"></a>`
                        output += `<h4 class="col-sm-5">Rating: ${x[i].rating}</h4></li>`
                    }
                    output += "</ul>"
                    $("#imageAndRating").html(output);
                    $("#urlid").val('');
                    $("#addform")[0].reset();
                }
            })
        })
    </script>

</body>

</html>